{% set stats = h.advanced_stats() %}
{% set selected = h.selected_stats() %}
{% set stat_width = h.stat_width() %}
{% asset 'advancedstats/main' %}

<div class="module-stats">
  <div class="card box">
    <ul>
      {% block stats_group %}
      {% if 'datasets' in selected %}
      <li class="{{ stat_width }}">
        <a href="{{ h.url_for('dataset.search') }}">
          <i class="fa fa-database fa-3x"></i><br>
          <strong>{{ h.SI_number_span(stats.dataset_count) }}</strong>
          {{ _('dataset') if stats.dataset_count == 1 else _('datasets') }}
        </a>
      </li>
      {% endif %}
      {% if 'users' in selected %}
      <li class="{{ stat_width }}">
        <a href="{{ h.url_for('user.index') }}">
          <i class="fa fa-user fa-3x"></i><br>
          <strong>{{ h.SI_number_span(stats.user_count) }}</strong>
          {{ _('user') if stats.user_count == 1 else _('users') }}
        </a>
      </li>
      {% endif %}
      {% if 'organizations' in selected %}
      <li class="{{ stat_width }}">
        <a href="{{ h.url_for('organization.index') }}">
          <i class="fa fa-building fa-3x"></i><br>
          <strong>{{ h.SI_number_span(stats.organization_count) }}</strong>
          {{ _('organization') if stats.organization_count == 1 else _('organizations') }}
        </a>
      </li>
      {% endif %}
      {% if 'groups' in selected %}
      <li class="{{ stat_width }}">
        <a href="{{ h.url_for('group.index') }}">
          <i class="fa fa-folder-open fa-3x"></i><br>
          <strong>{{ h.SI_number_span(stats.group_count) }}</strong>
          {{ _('group') if stats.group_count == 1 else _('groups') }}
        </a>
      </li>
      {% endif %}
      {% if 'resources' in selected %}
      <li class="{{ stat_width }}">
        <i class="fa fa-file fa-3x"></i><br>
        <strong>{{ h.SI_number_span(stats.resource_count) }}</strong>
        {{ _('resource') if stats.resource_count == 1 else _('resources') }}
      </li>
      {% endif %}
      {% if 'jupyter' in selected %}
      <li class="{{ stat_width }}">
        <a href="{{ h.url_for('dataset.search') ~ '?res_format=ipynb' }}">
          <i class="fa fa-code fa-3x"></i><br>
          <strong>{{ h.SI_number_span(stats.jupyter_count) }}</strong>
          {{ _('Jupyter notebook') if stats.jupyter_count == 1 else _('Jupyter notebooks') }}
        </a>
      </li>
      {% endif %}
      {% if 'triples' in selected %}
      <li class="{{ stat_width }}">
        <i class="fa fa-{{ h.kg_triple_icon() }} fa-3x"></i><br>
        <strong>{{ h.SI_number_span(stats.triples) }}</strong>
        {{ _('RDF triple') if stats.triples == 1 else _('RDF triples') }}
      </li>
      {% endif %}
      {% endblock %}
    </ul>
    <div style="color: gray; text-align: right; padding-right: 20px;">
      <span id="last-updated" {% if stats.datetime != '-1' %}data-utc="{{ stats.datetime }}"{% else %}data-utc=""{% endif %}>
        {% if stats.datetime == '-1' %}
          {{ _('Statistics not yet collected.') }}
        {% else %}
          Loading...
        {% endif %}
      </span>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const lastUpdatedElement = document.getElementById('last-updated'),
          utcDateTime = lastUpdatedElement.getAttribute('data-utc');

    if (utcDateTime) {
        const date = new Date(utcDateTime),
              options = {
                  year: 'numeric',
                  month: '2-digit',  // Ensures month is always 2 digits
                  day: '2-digit',    // Ensures day is always 2 digits
                  hour: '2-digit',
                  minute: '2-digit',
                  second: '2-digit',
                  timeZoneName: 'short'
              },
              formatter = new Intl.DateTimeFormat(undefined, options),
              localDateString = formatter.format(date);
        lastUpdatedElement.textContent = "{{ _('Last updated:') }} " + localDateString;
    }
});
</script>
